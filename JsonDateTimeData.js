var data= [{"packageId":126,"nr":0,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost linkedin","target":5,"title":"Posted","text":"","body":"Posted update in 'channel: jason-walsh (LinkedIn)' 3 April 2014, 14:32","start":"3 April 2014, 14:32","end":"3 April 2014, 14:32","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to LinkedIn at 3 April 2014, 14:32"},{"packageId":130,"nr":378,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"testing post, get the #RefNumber","body":"Posted update in 'channel: JsonWalsh (Twitter)' 3 April 2014, 16:04","start":"3 April 2014, 16:04","end":"3 April 2014, 16:04","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 3 April 2014, 16:04"},{"packageId":131,"nr":0,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost linkedin","target":5,"title":"Posted","text":"","body":"Posted update in 'channel: jason-walsh (LinkedIn)' 3 April 2014, 17:26","start":"3 April 2014, 17:26","end":"3 April 2014, 17:26","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to LinkedIn at 3 April 2014, 17:26"},{"packageId":132,"nr":395,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost facebook","target":1,"title":"Posted","text":"get Post where SocialPostID is not null","body":"Posted update in 'channel: fitnessmatters.nl (Facebook)' 3 April 2014, 17:31","start":"3 April 2014, 17:31","end":"3 April 2014, 17:31","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Facebook at 3 April 2014, 17:31"},{"packageId":133,"nr":0,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost linkedin","target":6,"title":"Posted","text":"","body":"Posted update in 'channel: john-fittest (LinkedIn)' 3 April 2014, 17:38","start":"3 April 2014, 17:38","end":"3 April 2014, 17:38","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to LinkedIn at 3 April 2014, 17:38"},{"packageId":137,"nr":505,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"schedule now","body":"Posted update in 'channel: JsonWalsh (Twitter)' 4 April 2014, 13:30","start":"4 April 2014, 13:30","end":"4 April 2014, 13:30","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 4 April 2014, 13:30"},{"packageId":154,"nr":0,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost linkedin","target":6,"title":"Posted","text":"","body":"Posted update in 'channel: john-fittest (LinkedIn)' 4 April 2014, 14:54","start":"4 April 2014, 14:54","end":"4 April 2014, 14:54","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to LinkedIn at 4 April 2014, 14:54"},{"packageId":153,"nr":525,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"Lorme sipsudmdolro dsf sfd","body":"Posted update in 'channel: JsonWalsh (Twitter)' 4 April 2014, 14:54","start":"4 April 2014, 14:54","end":"4 April 2014, 14:54","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 4 April 2014, 14:54"},{"packageId":156,"nr":0,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost linkedin","target":6,"title":"Posted","text":"","body":"Posted update in 'channel: john-fittest (LinkedIn)' 4 April 2014, 14:55","start":"4 April 2014, 14:55","end":"4 April 2014, 14:55","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to LinkedIn at 4 April 2014, 14:55"},{"packageId":155,"nr":524,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"Lomreipms last day","body":"Posted update in 'channel: JsonWalsh (Twitter)' 4 April 2014, 14:55","start":"4 April 2014, 14:55","end":"4 April 2014, 14:55","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 4 April 2014, 14:55"},{"packageId":181,"nr":892,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"Test timezone offset","body":"Posted update in 'channel: JsonWalsh (Twitter)' 8 April 2014, 13:34","start":"8 April 2014, 13:34","end":"8 April 2014, 13:34","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 8 April 2014, 13:34"},{"packageId":183,"nr":900,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"dsfsdfsdf","body":"Posted update in 'channel: JsonWalsh (Twitter)' 8 April 2014, 14:00","start":"8 April 2014, 14:00","end":"8 April 2014, 14:00","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 8 April 2014, 14:00"},{"packageId":186,"nr":0,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost linkedin","target":6,"title":"Posted","text":"","body":"Posted update in 'channel: john-fittest (LinkedIn)' 8 April 2014, 14:04","start":"8 April 2014, 14:04","end":"8 April 2014, 14:04","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to LinkedIn at 8 April 2014, 14:04"},{"packageId":188,"nr":1293,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"My image shared http://t.co/3hJ6yi8Gex","body":"Posted update in 'channel: JsonWalsh (Twitter)' 10 April 2014, 14:33","start":"10 April 2014, 14:33","end":"10 April 2014, 14:33","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 10 April 2014, 14:33"},{"packageId":189,"nr":1300,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"Multiple image handling http://t.co/axHqUID1xM","body":"Posted update in 'channel: JsonWalsh (Twitter)' 10 April 2014, 14:47","start":"10 April 2014, 14:47","end":"10 April 2014, 14:47","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 10 April 2014, 14:47"},{"packageId":205,"nr":0,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost linkedin","target":6,"title":"Posted","text":"","body":"Posted update in 'channel: john-fittest (LinkedIn)' 11 April 2014, 13:45","start":"11 April 2014, 13:45","end":"11 April 2014, 13:45","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to LinkedIn at 11 April 2014, 13:45"},{"packageId":205,"nr":1427,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost facebook","target":1,"title":"Posted","text":"Posts and schedule over filled test","body":"Posted update in 'channel: fitnessmatters.nl (Facebook)' 11 April 2014, 13:45","start":"11 April 2014, 13:45","end":"11 April 2014, 13:45","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Facebook at 11 April 2014, 13:45"},{"packageId":205,"nr":1432,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"Posts and schedule over filled test","body":"Posted update in 'channel: JsonWalsh (Twitter)' 11 April 2014, 13:45","start":"11 April 2014, 13:45","end":"11 April 2014, 13:45","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 11 April 2014, 13:45"},{"packageId":204,"nr":0,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost linkedin","target":5,"title":"Posted","text":"","body":"Posted update in 'channel: jason-walsh (LinkedIn)' 11 April 2014, 14:00","start":"11 April 2014, 14:00","end":"11 April 2014, 14:00","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to LinkedIn at 11 April 2014, 14:00"},{"packageId":204,"nr":0,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost linkedin","target":6,"title":"Posted","text":"","body":"Posted update in 'channel: john-fittest (LinkedIn)' 11 April 2014, 14:00","start":"11 April 2014, 14:00","end":"11 April 2014, 14:00","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to LinkedIn at 11 April 2014, 14:00"},{"packageId":204,"nr":1434,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost facebook","target":1,"title":"Posted","text":"Overfilled schedule post","body":"Posted update in 'channel: fitnessmatters.nl (Facebook)' 11 April 2014, 14:00","start":"11 April 2014, 14:00","end":"11 April 2014, 14:00","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Facebook at 11 April 2014, 14:00"},{"packageId":204,"nr":1438,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"Overfilled schedule post","body":"Posted update in 'channel: JsonWalsh (Twitter)' 11 April 2014, 14:00","start":"11 April 2014, 14:00","end":"11 April 2014, 14:00","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 11 April 2014, 14:00"},{"packageId":196,"nr":1559,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"Lorme sipm suchedle next 7","body":"Posted update in 'channel: JsonWalsh (Twitter)' 11 April 2014, 17:45","start":"11 April 2014, 17:45","end":"11 April 2014, 17:45","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 11 April 2014, 17:45"},{"packageId":200,"nr":1511,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost facebook","target":1,"title":"Posted","text":"schedule now next 10","body":"Posted update in 'channel: fitnessmatters.nl (Facebook)' 14 April 2014, 10:26","start":"14 April 2014, 10:26","end":"14 April 2014, 10:26","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Facebook at 14 April 2014, 10:26"},{"packageId":198,"nr":1510,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost facebook","target":1,"title":"Posted","text":"schedule next 9","body":"Posted update in 'channel: fitnessmatters.nl (Facebook)' 14 April 2014, 10:27","start":"14 April 2014, 10:27","end":"14 April 2014, 10:27","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Facebook at 14 April 2014, 10:27"},{"packageId":191,"nr":1540,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"Next today schedule2","body":"Posted update in 'channel: JsonWalsh (Twitter)' 14 April 2014, 10:27","start":"14 April 2014, 10:27","end":"14 April 2014, 10:27","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 14 April 2014, 10:27"},{"packageId":193,"nr":1541,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"lorem sipm 4","body":"Posted update in 'channel: JsonWalsh (Twitter)' 14 April 2014, 10:27","start":"14 April 2014, 10:27","end":"14 April 2014, 10:27","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 14 April 2014, 10:27"},{"packageId":195,"nr":1542,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"scheulde next 6","body":"Posted update in 'channel: JsonWalsh (Twitter)' 14 April 2014, 10:27","start":"14 April 2014, 10:27","end":"14 April 2014, 10:27","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 14 April 2014, 10:27"},{"packageId":192,"nr":1543,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"next schedule 3","body":"Posted update in 'channel: JsonWalsh (Twitter)' 14 April 2014, 10:27","start":"14 April 2014, 10:27","end":"14 April 2014, 10:27","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 14 April 2014, 10:27"},{"packageId":201,"nr":1544,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"schedule next 11","body":"Posted update in 'channel: JsonWalsh (Twitter)' 14 April 2014, 10:27","start":"14 April 2014, 10:27","end":"14 April 2014, 10:27","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 14 April 2014, 10:27"},{"packageId":197,"nr":0,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost linkedin","target":6,"title":"Posted","text":"","body":"Posted update in 'channel: john-fittest (LinkedIn)' 14 April 2014, 10:28","start":"14 April 2014, 10:28","end":"14 April 2014, 10:28","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to LinkedIn at 14 April 2014, 10:28"},{"packageId":199,"nr":1509,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost facebook","target":1,"title":"Posted","text":"schedule next loremsip usme 9","body":"Posted update in 'channel: fitnessmatters.nl (Facebook)' 14 April 2014, 10:28","start":"14 April 2014, 10:28","end":"14 April 2014, 10:28","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Facebook at 14 April 2014, 10:28"},{"packageId":194,"nr":1539,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"schedule next 5","body":"Posted update in 'channel: JsonWalsh (Twitter)' 14 April 2014, 10:28","start":"14 April 2014, 10:28","end":"14 April 2014, 10:28","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 14 April 2014, 10:28"},{"packageId":190,"nr":1560,"code":"addpost","type":"transaction","subtype":"completed","className":"tra-addpost twitter","target":4,"title":"Posted","text":"today schedule 1","body":"Posted update in 'channel: JsonWalsh (Twitter)' 14 April 2014, 10:29","start":"14 April 2014, 10:29","end":"14 April 2014, 10:29","allDay":false,"editable":false,"durationEditable":false,"description":"Posted item to Twitter at 14 April 2014, 10:29"},{"packageId":187,"code":"addpost","target":1,"type":"transaction","subtype":"scheduled","className":"tra-addpost facebook","title":"Scheduled","body":"Scheduled post to Facebook at 23 April 2014, 12:07","text":" test","start":"23 April 2014, 12:07","description":"Scheduled post to Facebook at 23 April 2014, 12:07","end":"23 April 2014, 12:07","allDay":false,"editable":false,"durationEditable":false},{"packageId":207,"code":"addpost","target":4,"type":"transaction","subtype":"scheduled","className":"tra-addpost twitter","title":"Scheduled","body":"Scheduled post to Twitter at 30 April 2014, 12:00","text":"Test last day of month","start":"30 April 2014, 12:00","description":"Scheduled post to Twitter at 30 April 2014, 12:00","end":"30 April 2014, 12:00","allDay":false,"editable":false,"durationEditable":false},{"packageId":208,"code":"addpost","target":1,"type":"transaction","subtype":"scheduled","className":"tra-addpost facebook","title":"Scheduled","body":"Scheduled post to Facebook at 30 April 2014, 12:00","text":"test last day","start":"30 April 2014, 12:00","description":"Scheduled post to Facebook at 30 April 2014, 12:00","end":"30 April 2014, 12:00","allDay":false,"editable":false,"durationEditable":false},{"packageId":208,"code":"addpost","target":6,"type":"transaction","subtype":"scheduled","className":"tra-addpost linkedin","title":"Scheduled","body":"Scheduled post to LinkedIn at 30 April 2014, 12:00","text":"test last day","start":"30 April 2014, 12:00","description":"Scheduled post to LinkedIn at 30 April 2014, 12:00","end":"30 April 2014, 12:00","allDay":false,"editable":false,"durationEditable":false},{"packageId":208,"code":"addpost","target":4,"type":"transaction","subtype":"scheduled","className":"tra-addpost twitter","title":"Scheduled","body":"Scheduled post to Twitter at 30 April 2014, 12:00","text":"test last day","start":"30 April 2014, 12:00","description":"Scheduled post to Twitter at 30 April 2014, 12:00","end":"30 April 2014, 12:00","allDay":false,"editable":false,"durationEditable":false},{"packageId":209,"code":"addpost","target":4,"type":"transaction","subtype":"scheduled","className":"tra-addpost twitter","title":"Scheduled","body":"Scheduled post to Twitter at 30 April 2014, 12:00","text":"test","start":"30 April 2014, 12:00","description":"Scheduled post to Twitter at 30 April 2014, 12:00","end":"30 April 2014, 12:00","allDay":false,"editable":false,"durationEditable":false},{"packageId":210,"code":"addpost","target":5,"type":"transaction","subtype":"scheduled","className":"tra-addpost linkedin","title":"Scheduled","body":"Scheduled post to LinkedIn at 30 April 2014, 12:00","text":"test","start":"30 April 2014, 12:00","description":"Scheduled post to LinkedIn at 30 April 2014, 12:00","end":"30 April 2014, 12:00","allDay":false,"editable":false,"durationEditable":false},{"packageId":211,"code":"addpost","target":1,"type":"transaction","subtype":"scheduled","className":"tra-addpost facebook","title":"Scheduled","body":"Scheduled post to Facebook at 30 April 2014, 13:15","text":"Test last day post","start":"30 April 2014, 13:15","description":"Scheduled post to Facebook at 30 April 2014, 13:15","end":"30 April 2014, 13:15","allDay":false,"editable":false,"durationEditable":false},{"packageId":221,"code":"addpost","target":1,"type":"transaction","subtype":"scheduled","className":"tra-addpost facebook","title":"Scheduled","body":"Scheduled post to Facebook at 30 April 2014, 13:15","text":"fb may post last day post","start":"1 May 2014, 11:15","description":"Scheduled post to Facebook at 1 May 2014, 11:15","end":"1 May 2014, 11:15","allDay":false,"editable":false,"durationEditable":false},{"packageId":222,"code":"addpost","target":1,"type":"transaction","subtype":"scheduled","className":"tra-addpost facebook","title":"Scheduled","body":"Scheduled post to Facebook at 30 April 2014, 13:15","text":"Blah blah lorem ipsum last day post","start":"1 May 2014, 13:15","description":"Scheduled post to Facebook at 1 May 2014, 13:15","end":"1 May 2014, 13:15","allDay":false,"editable":false,"durationEditable":false}];
                                                                                                                         

function doStuff(data) {
   // console.log('data = ', data);
    
console.log('============================================================');
    for (var i in data) {
        console.log(JSON.stringify(data[i]));
    }
console.log('============================================================');
    
    //sort posts & scheduled posts in data
    data.sort(function (a, b) {
        var c = new Date(a.start);
        var d = new Date(b.start);
        return c - d;
    });
    
    var day = -1, dayEvtCounter = 0, month = -1;
    
    $('.slotContainer').removeClass('agendaWeek');
    $('.slotContainer').removeClass('agendaDay');
    var totalIndex = (data.length -1);
        
    for (var i in (data)) {
        var evt = data[i];
        var newDay = new Date(evt.start).getDate();
        var newMonth= new Date(evt.start).getMonth();
        
        if ((newDay !== day && newMonth == month) || i == totalIndex) {
            // If its the last item add it to the counter
            if (i == totalIndex) { dayEvtCounter = dayEvtCounter + 1; }
            
            var endSepMidnight = new Date(evt.start);
            //Make this the last item of the day
            endSepMidnight.setHours(23, 59, 0);
            
            //Add to the last parsed date
            (i > 0) ? endSepMidnight.setDate(new Date(data[(i - 1)].start).getDate()) : endSepMidnight.setDate(new Date(data[i].start).getDate());                         
            
          //  var fullcal = $.fullCalendar;
            var sepTitle = ((dayEvtCounter + 1) - 4) + " more event";
            sepTitle += (((dayEvtCounter + 1) - 4) == 1) ? "" : "s"
            
            var sep = {
                allDay: false,
                body: "There are more events " + endSepMidnight,
                className: "tra-addpost mock",
                description: "There are more events" + endSepMidnight,
                durationEditable: false,
                editable: false,
                end: endSepMidnight,
                start: endSepMidnight,
                title: sepTitle,
                type: "separator",
            };
            //Add it if we're over the limit of events shown
            if (dayEvtCounter > 3) {
                data.push(sep);
            }
            if (i == totalIndex && newMonth != month) {
                dayEvtCounter = 4;
            }
            else {
                dayEvtCounter = 0;
            }
        }
        else {
            if (newMonth != month) { dayEvtCounter = 0; }
            else { dayEvtCounter++;  }
        }
        if (newMonth > month) { dayEvtCounter = 0; }
        if (dayEvtCounter > 3) {
            evt.className += " hide";
        }
        day = newDay;
        month = newMonth;
    }    
    renderEvent(data);
}

function renderEvent(data){
    for (var i in data) {
        $('<div>').addClass('day').appendTo('.main').html(data[i].start + ' - ' + ((data[i].className.indexOf('hide') != -1) ? 'hidden' : ''));
    }
    
//$('<div>').addClass('day').appendTo('.main').html(data.start);
}

doStuff(data);
